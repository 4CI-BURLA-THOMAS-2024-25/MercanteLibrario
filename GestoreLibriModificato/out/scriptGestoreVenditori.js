(()=>{"use strict";class I{constructor(I,e,E,O,t,o){this.libroDellaCopiaISBN=I.isbn,this.codiceUnivoco=e,this.prezzoCopertina=E,this.prezzoScontato=parseFloat((.5*E).toFixed(2)),this.venditoreID=O.id,this.stato=t,this.ultimaModifica=o}toString(){return`${this.libroDellaCopiaISBN};${this.codiceUnivoco};${this.prezzoCopertina};${this.prezzoScontato};${this.venditoreID};${this.stato};${this.ultimaModifica}`}}class e{constructor(I,e,E,O,t,o){let n=Number(t);this.id=I>=0?I:0,this.nome=null!=e?e:"-",this.cognome=null!=E?E:"-",this.email=null!=O?O:"-",this.nTelefono=n>0?n:0,this.classe=null!=o?o:"-"}toString(){return[this.id,this.nome,this.cognome,this.email,this.nTelefono,this.classe].join(" ")}}const E=new BroadcastChannel("aggiornamentoDatabase");class O{constructor(I,e,E,O,t,o,n){this.materia=null!=I?I:"-",Number(e)>0?this.isbn=Number(e):this.isbn=0,this.autore=null!=E?E:"-",this.titolo=null!=O?O:"-",null!=t&&1==t.length?this.volume=t:this.volume="-",this.editore=null!=o?o:"-",this.classe=null!=n?n:"-"}toString(){return[this.materia,this.isbn,this.autore,this.titolo,this.volume,this.editore,this.classe].join(" ")}}const t=[new O("DIRITTO ED ECONOMIA","9788823367739","D'AMELIO MARIA GIOVANNA","FUTURO IN TASCA (IL) - LIBRO MISTO CON LIBRO DIGITALE  CORSO DI DIRITTO ED ECONOMIA PER IL PRIMO BIENNIO - VOLUME UNICO","U","TRAMONTANA","1 - 2"),new O("DIRITTO ED ECONOMIA","9788861603820","MARIA RITA CATTANI","NUOVO SISTEMA DIRITTO APP - DIRITTO COMMERCIALE (IL)","2","PARAMOND","4"),new O("DIRITTO ED ECONOMIA","9788861604711","CATTANI MARIA RITA, GUZZI CLAUDIO","SISTEMA DIRITTO SECONDA EDIZIONE - SECONDO BIENNIO  CORSO DI DIRITTO","U","PARAMOND","3"),new O("DIRITTO ED ECONOMIA","9788891420091","AVOLIO ALESSANDRA","TRASPORTI LOGISTICA LEGGI E MERCATI DIRITTO ED ECONOMIA PER SECONDO BIENNIO E QUINTO ANNO ARTICOL LOGISTICA","U","SIMONE PER LA SCUOLA","5"),new O("ELETTROTECNICA ED ELETTRONICA","9788823373266","AMBROSINI ENRICO, SPADARI FILIPPO","ELETTROTECNICA ED ELETTRONICA VOLUME 1","1","TRAMONTANA","3"),new O("ELETTROTECNICA ED ELETTRONICA","9788820378493","CONTE GAETANO, IMPALLOMENI EMANUELE","ELETTROTECNICA, ELETTRONICA E AUTOMAZIONE NUOVA EDIZIONE OPENSCHOOL PER IL SECONDO BIENNIO DELL'INDIRIZZO TRASPORTI E LOGISTICA","U","HOEPLI","3 - 4 - 5"),new O("ELETTROTECNICA ED ELETTRONICA","9788823342002","AMBROSINI, SPADARI","ELETTROTECNICA ED ELETTRONICA 2 CON OPENBOOK VOLUME 2 + OPENBOOK","2","TRAMONTANA","4"),new O("ELETTROTECNICA ED ELETTRONICA","9788823346000","AMBROSINI, SPADARI","ELETTROTECNICA ED ELETTRONICA 3 CON OPENBOOK VOLUME 3 + OPENBOOK","3","TRAMONTANA","5"),new O("GEOGRAFIA","9788851187477","BIANCHI S KOEHLER R","GEOBASE-CORSO DI GEOGRAFIA GENERALE ED ECONOMICA PER IST.TECNICI PROFESS. VOLUME BASE+ EBOOK","U","DE AGOSTINI","2"),new O("GESTIONE PROGETTO E ORGANIZZAZIONE D'IMPRESA","9788874858323","IACOBELLI CESARE, COTTONE MARIO, GAIDO ELENA","DALL'IDEA ALLA STARTUP VOLUME UNICO","U","JUVENILIA","5"),new O("INFORMATICA","9788826821887","LORENZI AGOSTINO, RIZZI ANDREA","PRO.TECH B","2","ATLAS","4"),new O("INFORMATICA","9788836007745","CAMAGNI PAOLO, NIKOLASSY RICCARDO","CORSO DI INFORMATICA SQL & PHP  PERCORSI MODULARI PER LINGUAGGI DI PROGRAMMAZIONE","U","HOEPLI","5"),new O("INGLESE","9788844119836","ROBBA MARGHERITA, FAGGIANI MARIA LETIZIA","NEW MECHWAYS - ENGLISH FOR MECHANICS, MECHATRONICS AND ENERGY","U","EDISCO","3 - 4 - 5"),new O("INGLESE","9788861618176","SBOLOGNINI, B C BARBER, KO'MALLEY","CAREER PATHS IN TECHNOLOGY ELECTRICITY AND ELECTRONICSÂ INFORMATION TECHNOLOGY AND TELECOMMUNICATIONS","U","LANG EDIZIONI","3 - 4 - 5"),new O("INGLESE","9788883394485","AA VV","MY VOICE A2/B1","U","PEARSON LONGMAN","1 - 2"),new O("INGLESE","9788883394492","AA VV","MY VOICE B1/B1+","U","PEARSON LONGMAN","2"),new O("INGLESE","9788883395994","AA VV","MY VOICE B2","U","PEARSON LONGMAN","3 - 4 - 5"),new O("INGLESE","9788899673154","GUALANDRI, CANELLINI","ALL ABOUT LOGISTICS PLUS + CD AUDIO 50241  STORAGE & DELIVERY","U","TRINITY WHITEBRIDGE","3 - 4 - 5"),new O("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830206779","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 - LIBRO MISTO CON LIBRO DIGITALE  VOLUME 3A + VOLUME 3B + FASCICOLO 5° ANNO","3","LA NUOVA ITALIA EDITRICE","5"),new O("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830206793","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 - LIBRO MISTO CON LIBRO DIGITALE  VOL 1+LABORATORIO 3° 4° ANNO+DIVINA COMMEDIA+INVALSI","1","LA NUOVA ITALIA EDITRICE","3"),new O("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830212428","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 - LIBRO MISTO CON LIBRO DIGITALE  VOL 2 CON LEOPARDI+LABORATORIO 3° 4° ANNO","2","LA NUOVA ITALIA EDITRICE","4"),new O("ITALIANO ANTOLOGIE","9788869109225","SIMONA BRENNA, DANIELE DACCO","STORIE IN TASCA - NARRATIVA CON VEDERE LE STORIE","U","B.MONDADORI","1"),new O("ITALIANO ANTOLOGIE","9788869109263","SIMONA BRENNA, DANIELE DACCO","STORIE IN TASCA - POESIA E TEATRO CON ANTOLOGIA DEI PROMESSI SPOSI","U","B.MONDADORI","2"),new O("ITALIANO EPICA","9788869109348","SIMONA BRENNA, DANIELE DACCO","STORIE IN TASCA - MITO ED EPICA","U","B.MONDADORI","1"),new O("ITALIANO GRAMMATICA","9791254550106","SAVIGLIANO C","GRAMMATUTOR - PER PARLARE E SCRIVERE BENE  VOLUME BASE + LABORATORIO DELLE COMPETENZE + EBOOK","U","GARZANTI SCUOLA","1 - 2"),new O("LOGISTICA","9788836007943","DALLARI FABRIZIO","CORSO DI LOGISTICA E TRASPORTI  ELEMENTI DI BASE, SOLUZIONI TECNICHE E MODELLI OPERATIVI","1","HOEPLI","3"),new O("LOGISTICA","9788836012275","DALLARI FABRIZIO, COSSU ELENA","CORSO DI LOGISTICA E TRASPORTI  ORGANIZZAZIONE E GESTIONE DELLA SUPPLY CHAIN E DELLA SICUREZZA","2","HOEPLI","4 - 5"),new O("MATEMATICA","9788849422979","SASSO LEONARDO, ZOLI ENRICO","COLORI DELLA MATEMATICA - EDIZIONE VERDE VOL. 3 + EBOOK +  STATISTICA E CALCOLO DELLE PROBABILITÀ","1","PETRINI","3"),new O("MATEMATICA","9788849422986","SASSO LEONARDO, ZOLI ENRICO","COLORI DELLA MATEMATICA - EDIZIONE VERDE VOL. 4 + EBOOK +","2","PETRINI","4"),new O("MATEMATICA","9788849422993","SASSO LEONARDO, ZOLI ENRICO","COLORI DELLA MATEMATICA - EDIZIONE VERDE VOL. 5 + EBOOK +","3","PETRINI","5"),new O("MATEMATICA","9788849425215","SASSO L ZOLI E","TUTTI I COLORI DELLA MATEMATICA - EDIZIONE VERDE - PRIMO BIENNIO  VOLUME 1 + QUADERNO DI INCLUSIONE E RECUPERO 1 + EBOOK","1","PETRINI","1"),new O("MATEMATICA","9788849425222","SASSO L ZOLI E","TUTTI I COLORI DELLA MATEMATICA - EDIZIONE VERDE - PRIMO BIENNIO  VOLUME 2 + QUADERNO DI INCLUSIONE E RECUPERO 2 + EBOOK","2","PETRINI","2"),new O("MECCANICA","9788820383329","AA VV","MANUALE DEL MANUTENTORE","U","HOEPLI","3 - 4 - 5"),new O("RELIGIONE","9788839303394","CERA T, FAMA' A","STRADA CON L'ALTRO (LA) - VOLUME UNICO LEZIONI E PERCORSI + EBOOK","U","MARIETTI SCUOLA","3 - 4 - 5"),new O("RELIGIONE","9788839303943","CERA T, FAMA A, SORICE O","STRADA CON L'ALTRO - EDIZIONE VERDE (LA)  VOLUME UNICO + UDA MULTIDISCIPLINARI DI EDUCAZIONE CIVICA E IRC + EBOOK","U","MARIETTI SCUOLA","1 - 2"),new O("SCIENZE DELLA NAVIGAZIONE","9788836015221","DALLARI FABRIZIO, COSSU ELENA","CORSO DI LOGISTICA E TRASPORTI  SPEDIZIONI, NORMATIVA E COMMERCIO INTERNAZIONALE","3","HOEPLI","3"),new O("SCIENZE DELLA TERRA","9788808690913","LUPIA PALMIERI ELVIDIO, PAROTTO MAURIZIO","SCIENZE DELLA TERRA 4ED. - VOL. U (LDM)","U","ZANICHELLI EDITORE","1"),new O("SCIENZE INTEGRATE (CHIMICA)","9788823365957","CORDIOLI DORIANO","CHIMICA PRATICA - LIBRO MISTO CON LIBRO DIGITALE  VOLUME UNICO PER IL BIENNIO","U","TRAMONTANA","1 - 2"),new O("SCIENZE INTEGRATE (FISICA)","9788863648850","WALKER","FISICA DI WALKER (LA) - VOLUME UNICO","U","LINX","1 - 2"),new O("SCIENZE INTEGRATE (SCIENZE DELLA TERRA E BIOLOGIA)","9788808554055","LUPIA PALMIERI ELVIDIO, PAROTTO MAURIZIO, SARACENI S, STRUMIA G","SCIENZE NATURALI 3ED. - BIOLOGIA (LDM) DI SILVIA SARACENI E GIORGIO STRUMIA","U","ZANICHELLI EDITORE","2"),new O("SISTEMI AUTOMATICI","9788820394844","CERRI FABRIZIO, ORTOLANI GIULIANO, VENTURI EZIO","NUOVO CORSO DI SISTEMI AUTOMATICI  PER LE ARTICOLAZIONI ELETTROTECNICA, ELETTRONICA E AUTOMAZIONE DEGLI ISTITUT","1","HOEPLI","3"),new O("SISTEMI AUTOMATICI","9788820394851","CERRI FABRIZIO, ORTOLANI GIULIANO, VENTURI EZIO","NUOVO CORSO DI SISTEMI AUTOMATICI  PER LE ARTICOLAZIONI ELETTROTECNICA, ELETTRONICA E AUTOMAZIONE DEGLI ISTITUT","2","HOEPLI","4"),new O("SISTEMI AUTOMATICI","9788836003785","CERRI FABRIZIO, ORTOLANI GIULIANO, VENTURI EZIO","NUOVO CORSO DI SISTEMI AUTOMATICI  PER L'ARTICOLAZIONE ELETTRONICA DEGLI ISTITUTI TECNICI SETTORE TECNOLOGICO","3","HOEPLI","5"),new O("SISTEMI E RETI","9788849423266","ANELLI S, MACCHI P, ANGIANI G, ZICCHIERI G","GATEWAY - SISTEMI E RETI SECONDA EDIZIONE - VOLUME 2 + EBOOK","2","PETRINI","4"),new O("SISTEMI E RETI","9788849423273","ANELLI S, MACCHI P, ANGIANI G, ZICCHIERI G","GATEWAY - SISTEMI E RETI SECONDA EDIZIONE - VOLUME 3 + EBOOK- IN PREPARAZIONE","3","PETRINI","5"),new O("SISTEMI E RETI","9788849426403","ANELLI S, MACCHI P","GATEWAY TERZA EDIZIONE + EBOOK VOLUME 1 PER IL III ANNO + EBOOK","1","PETRINI","3"),new O("STORIA","9788805076659","FELTRI FRANCESCO MARIA, BERTAZZONI MARIA MANUELA, NERI FRANCA","SCENARI 3 NOVECENTO E XXI SECOLO","3","SEI","5"),new O("STORIA","9788822197320","BRANCATI ANTONIO, PAGLIARANI TREBI","STORIA IN MOVIMENTO LIBRO MISTO CON LIBRO DIGITALE  VOLUME 3, LAVORARE CON LA STORIA 3","3","LA NUOVA ITALIA EDITRICE","5"),new O("STORIA","9788835055204","GENTILE, RONGA, ROSSI","FUCINA DI VULCANO - VOLUME 1 (LA)  CORSO DI STORIA ED EDUCAZ.CIVICA","1","LA SCUOLA EDITRICE","1 - 2"),new O("STORIA","9788835055211","GENTILE, RONGA, ROSSI","FUCINA DI VULCANO - VOLUME 2 (LA)  CORSO DI STORIA ED EDUCAZ.CIVICA","2","LA SCUOLA EDITRICE","2"),new O("STORIA","9788839538864","GIOVANNI DE LUNA, MARCO MERIGGI","VALORE STORIA 1 DALL'ANNO MILLE ALLA METÀ DEL SEICENTO","1","PARAVIA","3"),new O("STORIA","9788839538871","GIOVANNI DE LUNA, MARCO MERIGGI","VALORE STORIA 2 DALLA METÀ DEL SEICENTO ALLA FINE DELL'OTTOCENTO","2","PARAVIA","4"),new O("STRUTTURA, COSTRUZIONE, SISTEMI E IMPIANTI","9788884883148","AA VV","TECNICA DELL'AUTOMOBILE MANUALE DI TECNOLOGIA DEI VEICOLI A MOTORE","U","SAN MARCO","3 - 4 - 5"),new O("TECNOLOGIE E PROGETTAZIONE DI SISTEMI INFO","9788836011728","CAMAGNI PAOLO, NIKOLASSY RICCARDO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI INFORMATICI E DI TELECOMUNICAZION  PER L'ARTICOLAZIONE INFORMATICA DEGLI ISTITUTI TECNICI SETTORE TECNOLOGICO","1","HOEPLI","3"),new O("TECNOLOGIE E PROGETTAZIONE","9788823357150","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI - LIBRO MISTO  ART. ELETTRONICA - VOL. 1 + HUB YOUNG + HUB KIT","1","TRAMONTANA","3"),new O("TECNOLOGIE E PROGETTAZIONE","9788823357983","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI  ART. ELETTRONICA - VOL. 2 + HUB YOUNG + HUB KIT","2","TRAMONTANA","4"),new O("TECNOLOGIE E PROGETTAZIONE","9788823357990","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI  ART. ELETTRONICA - VOL. 3 + HUB YOUNG + HUB KIT","3","TRAMONTANA","5"),new O("TECNOLOGIE E TECNICHE DI RAPPRESENT.GRAFICA","9788841651780","ZANIN ALBINO, BALDISSERI GIORGIO","TECNOGRAFICA + DISEGNO + TECNOLOGIA","U","PRINCIPATO","1 - 2"),new O("TECNOLOGIE INFORMATICHE","9788820372279","BOSCAINI MAURIZIO, LUGHEZZANI FLAVIA, PRINCIVALLE DANIELA","MASTERMIND PENSARE - PROGRAMMARE - CONDIVIDERE. INFORMATICA PER IL PRIMO BIENNIO","U","HOEPLI","1"),new O("TELECOMUNICAZIONI","9788808159304","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI 1 (LMS LIBRO MISTO SCARICABILE)  RETI ELETTRICHE. FOND. ELETTRONICA DIGITALE. NOZIONI SIST. TELECOMUNICAZIONI","1","ZANICHELLI EDITORE","3"),new O("TELECOMUNICAZIONI","9788808228628","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI 2 (LIBRO MISTO SCARICABILE) MEZZI TRASMISSIVI. ELETTRONICA PER TELECOMUNICAZIONI. RETE TELEFONICA","2","ZANICHELLI EDITORE","4"),new O("TELECOMUNICAZIONI","9788808834997","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI - VOL 3 + RISORSE SCUOLABOOK PER TELECOM. RETI, SIST. E APP. TELECOMUNICAZIONI DIGITALI DI N. GENERAZIONE","3","ZANICHELLI EDITORE","5"),new O("TELECOMUNICAZIONI","9788823357037","AMBROSINI ENRICO, PERLASCA IPPOLITO, MAINI PIERPAOLO","TELECOMUNICAZIONI - LIBRO MISTO CON HUB LIBRO YOUNG  VOL. + HUB YOUNG + HUB KIT","U","TRAMONTANA","4")],o=new WebSocket('wss://appsdev.marconivr.it/libraio/serverNode');var n=function(I,e,E,O){return new(E||(E=Promise))((function(t,o){function n(I){try{i(O.next(I))}catch(I){o(I)}}function A(I){try{i(O.throw(I))}catch(I){o(I)}}function i(I){var e;I.done?t(I.value):(e=I.value,e instanceof E?e:new E((function(I){I(e)}))).then(n,A)}i((O=O.apply(I,e||[])).next())}))};const A=localStorage.getItem("contatoreMovimenti");let i,T,N=null!=A?Number(A):0,r=String(localStorage.getItem("passwordTentata"));const L=document.getElementById("aggiungiVenditore");null==L||L.addEventListener("click",(function(){null!=R&&(R.style.display="flex")}));const R=document.getElementById("popupNuovoVenditore"),C=document.getElementById("registraVenditore");null==C||C.addEventListener("click",(function(){return n(this,void 0,void 0,(function*(){let I=new Array(5);for(let e=0;e<l.length;e++)I[e]=l[e].value;const O=yield function(){return n(this,void 0,void 0,(function*(){return new Promise(((I,e)=>{const E=i.transaction("Venditori","readonly").objectStore("Venditori").openCursor(null,"prev");E.onsuccess=()=>{const e=E.result;I(e?e.primaryKey:null)},E.onerror=()=>{e(E.error)}}))}))}();let t;t=null!==O?O+1:1;const A=new e(t,I[0],I[1],I[2],Number(I[3]),I[4]),T=i.transaction("Venditori","readwrite").objectStore("Venditori").add(A);T.onsuccess=()=>n(this,void 0,void 0,(function*(){for(let I=0;I<l.length;I++)l[I].value="";N=Number(localStorage.getItem("contatoreMovimenti")),N++,localStorage.setItem("contatoreMovimenti",String(N)),E.postMessage({store:"Venditori"}),function(I){o.send("V-"+String(I.toString())+"-"+r)}(A),yield U(yield D()),M()})),T.onerror=()=>{console.log("Venditore già presente")}}))}));const c=document.getElementById("chiudiPopup");null==c||c.addEventListener("click",M);const l=document.querySelectorAll(".testoInputPopup"),s=document.getElementById("casellaRicerca");null==s||s.addEventListener("input",(function(){return n(this,void 0,void 0,(function*(){if(null!=T){let I,e=[];if(s&&""!==s.value.trim()){I=s.value.toLowerCase();for(let E=0;E<T.length;E++)T[E].toString().toLowerCase().includes(I)&&e.push(T[E]);yield U(e)}else yield U(T)}}))}));const S=document.getElementById("elencoCompletoCopie");null==S||S.addEventListener("click",(()=>{window.open("html/elencoCompletoCopie.html")}));const a=document.getElementById("elencoCopieVendute");null==a||a.addEventListener("click",(()=>{window.open("html/copieVendute.html")}));const d=document.getElementById("elencoCopieEliminate");null==d||d.addEventListener("click",(()=>{window.open("html/copieEliminate.html")}));const u=document.getElementById("apriCarrello");function M(){null!=R&&(R.style.display="none")}function D(){return n(this,void 0,void 0,(function*(){let I;try{const E=i.transaction("Venditori","readonly").objectStore("Venditori");return I=(yield new Promise(((I,e)=>{const O=E.getAll();O.onsuccess=()=>I(O.result),O.onerror=()=>e(O.error)}))).map((I=>new e(I.id,I.nome,I.cognome,I.email,I.nTelefono,I.classe))),I}catch(I){return window.alert("Errore durante il caricamento dei venditori:"+I),null}}))}function U(I){return n(this,void 0,void 0,(function*(){const e=document.getElementById("corpoTabellaVenditori");if(e.innerHTML="",null!=I){const E=yield function(){return n(this,void 0,void 0,(function*(){let I=new Array;const e=yield new Promise(((I,e)=>{const E=i.transaction("Venditori","readonly").objectStore("Venditori").getAll();E.onsuccess=()=>I(E.result),E.onerror=()=>e(E.error)}));for(const E of e){const e=(yield new Promise(((I,e)=>{const O=i.transaction("Copie","readonly").objectStore("Copie").index("venditoreID").getAll(E.id);O.onsuccess=()=>{const e=O.result.filter((I=>"V"===I.stato));I(e)},O.onerror=()=>e(O.error)}))).reduce(((I,e)=>I+e.prezzoScontato),0);I.push(Number(e.toFixed(2)))}return I}))}();for(let O=0;O<I.length;O++){const t=document.createElement("tr"),o=document.createElement("td");o.textContent=String(I[O].id),t.appendChild(o);const n=document.createElement("td");n.textContent=I[O].nome,t.appendChild(n);const A=document.createElement("td");A.textContent=I[O].cognome,t.appendChild(A);const i=document.createElement("td");i.textContent=I[O].email,t.appendChild(i);const T=document.createElement("td");T.textContent=String(I[O].nTelefono),t.appendChild(T);const N=document.createElement("td");N.textContent=I[O].classe,t.appendChild(N);const r=document.createElement("td");r.textContent=String(E[O]),t.appendChild(r);const L=document.createElement("td"),R=document.createElement("button");R.textContent="Visualizza copie consegnate",R.addEventListener("click",(()=>G(I[O].id))),L.appendChild(R),t.appendChild(L),e.appendChild(t)}}else console.log("Nessun venditore da mostrare")}))}function G(I){const e=screen.height,E=screen.width;window.open(`html/gestoreCopieVenditore.html?venditoreID=${I}`,"_blank",`menubar=no", height=${e}, width=${E}, top=0, left=0`)}null==u||u.addEventListener("click",(()=>{window.open("html/carrello.html")})),o.onopen=function(){console.log("connessione effettuata"),o.send("stato-"+N+"-"+r),console.log("stato-"+N+"-"+r),console.log(r)},o.onclose=function(){console.log("connessione server chiusa")},o.onerror=function(I){console.log("errore nel webSocket",I)},o.onmessage=function(O){console.log(O.data);let t=O.data.split("-");"V"===t[0]?function(I){n(this,void 0,void 0,(function*(){try{const O=I.split(" ");console.log(O);const t=new e(Number(O[0]),O[1],O[2],O[3],Number(O[4]),O[5]);yield function(I){return n(this,void 0,void 0,(function*(){const e=I,O=i.transaction("Venditori","readwrite").objectStore("Venditori").add(e);O.onsuccess=()=>n(this,void 0,void 0,(function*(){for(let I=0;I<l.length;I++)l[I].value="";E.postMessage({store:"Venditori"}),yield U(yield D())})),O.onerror=()=>{console.log("Venditore già presente")}}))}(t),N=Number(localStorage.getItem("contatoreMovimenti")),console.log("ciao"+N),N++,localStorage.setItem("contatoreMovimenti",String(N)),console.log("ciao"+N)}catch(I){console.error("Errore nel salvataggio del venditore mediante CF trasmesso da socket")}}))}(t[1]):"C"===t[0]&&function(e){n(this,void 0,void 0,(function*(){try{const O=e.split(";");console.log(O);const t=yield function(I){return n(this,void 0,void 0,(function*(){const e=i.transaction("Libri","readonly").objectStore("Libri"),E=yield new Promise(((E,O)=>{const t=e.get(I);t.onsuccess=()=>{t.result?E(t.result):O(new Error("Libro non trovato con ISBN"+I))},t.onerror=I=>{console.error("Errore nella richiesta:",I),O(t.error)}}));return E}))}(Number(O[0])),o=yield function(I){return n(this,void 0,void 0,(function*(){const e=i.transaction("Venditori","readonly").objectStore("Venditori"),E=yield new Promise(((E,O)=>{const t=e.get(I);t.onsuccess=()=>{t.result?E(t.result):O(new Error("Venditore non trovato con codice fiscale: "+I))},t.onerror=I=>{console.error("Errore nella richiesta:",I),O(t.error)}}));return E}))}(Number(O[4])),A=new I(t,Number(O[1]),Number(O[2]),o,O[5],O[6]);console.log(A),yield function(I){return n(this,void 0,void 0,(function*(){"CAR"===I.stato&&(I.stato="V");const e=i.transaction("Copie","readwrite").objectStore("Copie").put(I);e.onsuccess=()=>n(this,void 0,void 0,(function*(){E.postMessage({store:"Copie"}),yield U(yield D())})),e.onerror=()=>{console.log("Copia già presente")}}))}(A),N=Number(localStorage.getItem("contatoreMovimenti")),console.log("ciao"+N),N++,localStorage.setItem("contatoreMovimenti",String(N)),console.log("ciao"+N)}catch(I){console.error("Errore nel recupero del libro mediante ISBN o del venditore mediante CF trasmesso da socket")}}))}(t[1])},E.onmessage=I=>n(void 0,void 0,void 0,(function*(){"Venditori"===I.data.store&&(console.log("Aggiornamento ricevuto: ricarico venditori..."),yield U(yield D()))})),document.addEventListener("DOMContentLoaded",(()=>n(void 0,void 0,void 0,(function*(){try{i=yield function(){let I=new Promise(((I,e)=>{const E=indexedDB.open("Database",1);E.onerror=()=>{e(E.onerror)},E.onsuccess=()=>{const e=E.result;I(e)},E.onupgradeneeded=()=>{const I=E.result;if(!I.objectStoreNames.contains("Libri")){const e=I.createObjectStore("Libri",{keyPath:"isbn"});e.createIndex("materia","materia",{unique:!1}),e.createIndex("autore","autore",{unique:!1}),e.createIndex("titolo","titolo",{unique:!1}),e.createIndex("volume","volume",{unique:!1}),e.createIndex("editore","editore",{unique:!1}),e.createIndex("prezzoListino","prezzoListino",{unique:!1}),e.createIndex("classe","classe",{unique:!1})}if(!I.objectStoreNames.contains("Copie")){const e=I.createObjectStore("Copie",{keyPath:"codiceUnivoco"});e.createIndex("libroDellaCopiaISBN","libroDellaCopiaISBN",{unique:!1}),e.createIndex("prezzoScontato","prezzoScontato",{unique:!1}),e.createIndex("venditoreID","venditoreID",{unique:!1}),e.createIndex("stato","stato",{unique:!1}),e.createIndex("ultimaModifica","ultimaModifica",{unique:!1})}if(!I.objectStoreNames.contains("CopieRicevuta")){const e=I.createObjectStore("CopieRicevuta",{keyPath:"codiceUnivoco"});e.createIndex("libroDellaCopiaISBN","libroDellaCopiaISBN",{unique:!1}),e.createIndex("prezzoScontato","prezzoScontato",{unique:!1}),e.createIndex("venditoreID","venditoreID",{unique:!1}),e.createIndex("stato","stato",{unique:!1}),e.createIndex("ultimaModifica","ultimaModifica",{unique:!1})}if(!I.objectStoreNames.contains("Venditori")){const e=I.createObjectStore("Venditori",{keyPath:"id"});e.createIndex("nome","nome",{unique:!1}),e.createIndex("cognome","cognome",{unique:!1}),e.createIndex("email","email",{unique:!1}),e.createIndex("nTelefono","nTelefono",{unique:!0}),e.createIndex("classe","classe",{unique:!1})}}}));return I}(),console.log("Database aperto:",i.name),yield function(){return n(this,void 0,void 0,(function*(){try{const I=i.transaction("Libri","readonly").objectStore("Libri").count();I.onsuccess=()=>{0===I.result?function(){const I=i.transaction("Libri","readwrite"),e=I.objectStore("Libri");for(let I=0;I<t.length;I++)e.add(t[I]);I.oncomplete=()=>{console.log("Libri caricati con successo.")},I.onerror=()=>{console.error("Errore durante il caricamento dei libri statici.")}}():console.log("Libri già presenti nel database")},I.onerror=()=>{console.error("Errore nel conteggio dei libri.")}}catch(I){console.error("Errore durante l'accesso al DB:",I)}}))}(),T=yield D(),yield U(T)}catch(I){console.error("Errore apertura DB:",I)}}))))})();