(()=>{"use strict";class e{constructor(e,I,t,n,o,E){this.libroDellaCopiaISBN=e.isbn,this.codiceUnivoco=I,this.prezzoCopertina=t,this.prezzoScontato=parseFloat((.5*t).toFixed(2)),this.venditoreID=n.id,this.stato=o,this.ultimaModifica=E}toString(){return`${this.libroDellaCopiaISBN};${this.codiceUnivoco};${this.prezzoCopertina};${this.prezzoScontato};${this.venditoreID};${this.stato};${this.ultimaModifica}`}}class I{constructor(e,I,t,n,o,E){let A=Number(o);this.id=e>=0?e:0,this.nome=null!=I?I:"-",this.cognome=null!=t?t:"-",this.email=null!=n?n:"-",this.nTelefono=A>0?A:0,this.classe=null!=E?E:"-"}toString(){return[this.id,this.nome,this.cognome,this.email,this.nTelefono,this.classe].join(" ")}}const t=new BroadcastChannel("aggiornamentoDatabase");class n{constructor(e,I,t,n,o,E,A){this.materia=null!=e?e:"-",Number(I)>0?this.isbn=Number(I):this.isbn=0,this.autore=null!=t?t:"-",this.titolo=null!=n?n:"-",null!=o&&1==o.length?this.volume=o:this.volume="-",this.editore=null!=E?E:"-",this.classe=null!=A?A:"-"}toString(){return[this.materia,this.isbn,this.autore,this.titolo,this.volume,this.editore,this.classe].join(" ")}}const o=[new n("TELECOMUNICAZIONI","9788808159304","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI 1 (LMS LIBRO MISTO SCARICABILE)","1","ZANICHELLI EDITORE","3"),new n("TELECOMUNICAZIONI","9788808228628","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI 2 (LIBRO MISTO SCARICABILE)","2","ZANICHELLI EDITORE","4"),new n("SCIENZE INTEGRATE (CHIMICA)","9788808399861","BAGATTI FRANCO, ROPA CLAUDIA, CORRADI E +AC0- DESCO A","A TUTTA CHIMICA.VERDE +AC0- VOL. U (LDM)","U","ZANICHELLI EDITORE","1"),new n("GESTIONE PROGETTO, ORGANIZZAZIONE D'IMPRESA","9788808520081","OLLARI PAOLO","GESTIONE PROGETTO, ORGANIZZAZIONE D'IMPRESA 2ED. +AC0- VOL. U (LDM)","U","ZANICHELLI EDITORE","5"),new n("SCIENZE DELLA TERRA","9788808690913","LUPIA PALMIERI ELVIDIO, PAROTTO MAURIZIO","SCIENZE DELLA TERRA 4ED. +AC0- VOL. U (LDM)","U","ZANICHELLI EDITORE","1"),new n("TELECOMUNICAZIONI","9788808834997","BERTAZIOLI ONELIO","CORSO DI TELECOMUNICAZIONI +AC0- VOL  3  RISORSE SCUOLABOOK","3","ZANICHELLI EDITORE","5"),new n("SCIENZE INTEGRATE (BIOLOGIA)","9788808962034","LUPIA PALMIERI ELVIDIO, PAROTTO MAURIZIO, SARACENI SILVIA +AC0-  STRUMIA GIORGIO","SCIENZE NATURALI 4ED. +AC0- BIOLOGIA (LDM)","U","ZANICHELLI EDITORE","2"),new n("SCIENZE DELLA NAVIGAZIONE","9788820356361","NASTRO VINCENZO, MESSINA GABRIELLA, BATTIATO GIOVANNI","SCIENZE DELLA NAVIGAZIONE,  STRUTTURA E CONDUZIONE DEL MEZZO AEREO","1","HOEPLI","3"),new n("TECNOLOGIE INFORMATICHE","9788820372279","BOSCAINI MAURIZIO, LUGHEZZANI FLAVIA, PRINCIVALLE DANIELA","MASTERMIND","U","HOEPLI","1"),new n("ELETTROTECNICA ED ELETTRONICA","9788820378493","CONTE GAETANO, IMPALLOMENI EMANUELE","ELETTROTECNICA, ELETTRONICA E AUTOMAZIONE NUOVA EDIZIONE OPENSCHOOL","U","HOEPLI","3"),new n("MECCANICA","9788820383329","AA VV","MANUALE DEL MANUTENTORE","U","HOEPLI","3"),new n("TELECOMUNICAZIONI","9788823357037","AMBROSINI ENRICO, PERLASCA IPPOLITO, MAINI PIERPAOLO","TELECOMUNICAZIONI +AC0- LIBRO MISTO CON HUB LIBRO YOUNG","U","TRAMONTANA","3"),new n("TECNOLOGIE E PROGETTAZIONE","9788823357150","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI +AC0- LIBRO MISTO","1","TRAMONTANA","3"),new n("TECNOLOGIE E PROGETTAZIONE","9788823357983","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI","2","TRAMONTANA","4"),new n("TECNOLOGIE E PROGETTAZIONE","9788823357990","BOVE ENEA, PORTALURI GIORGIO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI ELETTRICI ED ELETTRONICI","3","TRAMONTANA","5"),new n("SCIENZE INTEGRATE (CHIMICA)","9788823365957","CORDIOLI DORIANO","CHIMICA PRATICA +AC0- LIBRO MISTO CON LIBRO DIGITALE","U","TRAMONTANA","2"),new n("DIRITTO ED ECONOMIA","9788823367739","D'AMELIO MARIA GIOVANNA","FUTURO IN TASCA (IL) +AC0- LIBRO MISTO CON LIBRO DIGITALE","U","TRAMONTANA","2"),new n("ELETTROTECNICA ED ELETTRONICA","9788823373266","AMBROSINI ENRICO, SPADARI FILIPPO","ELETTROTECNICA ED ELETTRONICA","1","TRAMONTANA","3"),new n("ELETTROTECNICA ED ELETTRONICA","9788823373273","AMBROSINI ENRICO, SPADARI FILIPPO","ELETTROTECNICA ED ELETTRONICA","2","TRAMONTANA","4"),new n("ELETTROTECNICA ED ELETTRONICA","9788823373280","AMBROSINI ENRICO, SPADARI FILIPPO","ELETTROTECNICA ED ELETTRONICA","3","TRAMONTANA","5"),new n("DIRITTO ED ECONOMIA","9788823381278","D'AMELIO","SCEGLI IL TUO FUTURO VOLUME UNICO","U","TRAMONTANA","1"),new n("INFORMATICA LINGUAGGI, SISTEMI OPERATIVI","9788826821900","LORENZI AGOSTINO, CAVALLI ENRICO, MORIGGIA VITTORIO","LINGUAGGIO PYTHON","U","ATLAS","3"),new n("INFORMATICA","9788826824772","LORENZI AGOSTINO, RIZZI ANDREA","SYNTAX","U","ATLAS","4"),new n("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830206779","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 +AC0- LIBRO MISTO CON LIBRO DIGITALE","3","LA NUOVA ITALIA EDITRICE","5"),new n("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830206793","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 +AC0- LIBRO MISTO CON LIBRO DIGITALE","1","LA NUOVA ITALIA EDITRICE","3"),new n("ITALIANO ANTOLOGIE E STORIA LETTERATURA","9788830212428","SAMBUGAR MARTA, SALA' GABRIELLA","CODICE LETTERARIO 2020 +AC0- LIBRO MISTO CON LIBRO DIGITALE","2","LA NUOVA ITALIA EDITRICE","4"),new n("STORIA","9788835055204","GENTILE, RONGA, ROSSI","FUCINA DI VULCANO +AC0- VOLUME 1 (LA)","1","LA SCUOLA EDITRICE","1"),new n("STORIA","9788835055211","GENTILE, RONGA, ROSSI","FUCINA DI VULCANO +AC0- VOLUME 2 (LA)","2","LA SCUOLA EDITRICE","2"),new n("SISTEMI AUTOMATICI","9788836003785","CERRI FABRIZIO, ORTOLANI GIULIANO, VENTURI EZIO","NUOVO CORSO DI SISTEMI AUTOMATICI","3","HOEPLI","5"),new n("LOGISTICA","9788836007943","DALLARI FABRIZIO","CORSO DI LOGISTICA E TRASPORTI","1","HOEPLI","3"),new n("TECNOLOGIE E PROGETTAZIONE DI SISTEMI INFORMATICI E DI TELECOMUNICAZIONI","9788836011728","CAMAGNI PAOLO, NIKOLASSY RICCARDO","TECNOLOGIE E PROGETTAZIONE DI SISTEMI INFORMATICI E DI TELECOMUNICAZION","1","HOEPLI","3"),new n("LOGISTICA","9788836012275","DALLARI FABRIZIO, COSSU ELENA","CORSO DI LOGISTICA E TRASPORTI","2","HOEPLI","4"),new n("MECCANICA E MACCHINE","9788836013456","FLACCAVENTO MICHELANGELO","NUOVO TECNICA AERONAUTICA","1","HOEPLI","3"),new n("SISTEMI AUTOMATICI","9788836018390","CERRI FABRIZIO, GHISLERI STEFANO, STRAZZERI DOMENICO","CORSO DI SISTEMI AUTOMATICI","1","HOEPLI","3"),new n("SISTEMI AUTOMATICI","9788836018406","CERRI FABRIZIO, GHISLERI STEFANO, STRAZZERI DOMENICO","CORSO DI SISTEMI AUTOMATICI","2","HOEPLI","4"),new n("RELIGIONE","9788839303394","CERA T, FAMA' A","STRADA CON L'ALTRO (LA) +AC0- VOLUME UNICO LEZIONI E PERCORSI  EBOOK","U","MARIETTI SCUOLA","4"),new n("RELIGIONE","9788839303943","CERA T  FAMA  A, SORICE O","STRADA CON L'ALTRO +AC0- EDIZIONE VERDE (LA)","U","MARIETTI SCUOLA","1"),new n("STORIA","9788839538864","GIOVANNI DE LUNA, MARCO MERIGGI","VALORE STORIA 1","1","PARAVIA","3"),new n("STORIA","9788839538871","GIOVANNI DE LUNA, MARCO MERIGGI","VALORE STORIA 2","2","PARAVIA","4"),new n("STORIA","9788839538888","GIOVANNI DE LUNA, MARCO MERIGGI","VALORE STORIA 3","3","PARAVIA","5"),new n("TECNOLOGIE E TECNICHE DI RAPPRESENT.GRAFICA","9788841651780","ZANIN ALBINO, BALDISSERI GIORGIO","TECNOGRAFICA  DISEGNO  TECNOLOGIA","U","PRINCIPATO","1"),new n("INGLESE","9788844119836","ROBBA MARGHERITA, FAGGIANI MARIA LETIZIA","NEW MECHWAYS +AC0- ENGLISH FOR MECHANICS, MECHATRONICS AND ENERGY","U","EDISCO","3"),new n("MATEMATICA","9788849422986","SASSO LEONARDO, ZOLI ENRICO","COLORI DELLA MATEMATICA +AC0- EDIZIONE VERDE VOL. 4  EBOOK ","2","PETRINI","4"),new n("MATEMATICA","9788849422993","SASSO LEONARDO, ZOLI ENRICO","COLORI DELLA MATEMATICA +AC0- EDIZIONE VERDE VOL. 5  EBOOK ","3","PETRINI","5"),new n("SISTEMI E RETI","9788849423273","ANELLI S, MACCHI P, ANGIANI G  ZICCHIERI G","GATEWAY +AC0- SISTEMI E RETI SECONDA EDIZIONE +AC0- VOLUME 3  EBOOK+AC0- IN PREPARAZIONE","3","PETRINI","5"),new n("MATEMATICA","9788849425215","SASSO L      ZOLI E","TUTTI I COLORI DELLA MATEMATICA +AC0- EDIZIONE VERDE +AC0- PRIMO BIENNIO","1","PETRINI","1"),new n("MATEMATICA","9788849425222","SASSO L      ZOLI E","TUTTI I COLORI DELLA MATEMATICA +AC0- EDIZIONE VERDE +AC0- PRIMO BIENNIO","2","PETRINI","2"),new n("SISTEMI E RETI","9788849426403","ANELLI S  MACCHI P","GATEWAY TERZA EDIZIONE  EBOOK","1","PETRINI","3"),new n("MATEMATICA","9788849426700","SASSO L    ZOLI E","TUTTI I COLORI DELLA MATEMATICA+AC0-ED.VERDE+AC0-SECONDO BIENNIO E QUINTO ANNO+EBP//Q-","1","PETRINI","3"),new n("SISTEMI E RETI","9788849430530","ANELLI S  MACCHI P","GATEWAY TERZA EDIZIONE  EBOOK","2","PETRINI","4"),new n("GEOGRAFIA","9788851187477","BIANCHI S  KOEHLER R","GEOBASE+AC0-CORSO DI GEOGRAFIA GENERALE ED ECONOMICA PER IST.TECNICI PROFESS.","U","DE AGOSTINI","2"),new n("DIRITTO","9788861604711","CATTANI MARIA RITA, GUZZI CLAUDIO","SISTEMA DIRITTO SECONDA EDIZIONE +AC0- SECONDO BIENNIO","U","PARAMOND","3"),new n("INGLESE","9788861618176","S  BOLOGNINI, B  C  BARBER, K  O'MALLEY","CAREER PATHS IN TECHNOLOGY","U","LANG EDIZIONI","3"),new n("SCIENZE INTEGRATE (FISICA)","9788863648850","WALKER","FISICA DI WALKER (LA) +AC0- VOLUME UNICO","U","LINX","1"),new n("ITALIANO ANTOLOGIE","9788868898854","MINUTO SABINA, GOLINELLI ELISA","LEGGERE CON IL WRW +AC0- VOLUME UNICO","U","PALUMBO","1"),new n("ITALIANO ANTOLOGIE","9788869109225","SIMONA BRENNA, DANIELE DACCO","STORIE IN TASCA +AC0- NARRATIVA CON VEDERE LE STORIE","U","B.MONDADORI","1"),new n("ITALIANO ANTOLOGIE","9788869109263","SIMONA BRENNA, DANIELE DACCO","STORIE IN TASCA +AC0- POESIA E TEATRO CON ANTOLOGIA DEI PROMESSI SPOSI","U","B.MONDADORI","2"),new n("ITALIANO EPICA","9788869109348","SIMONA BRENNA, DANIELE DACCO'","STORIE IN TASCA +AC0- MITO ED EPICA","U","B.MONDADORI","1"),new n("INGLESE","9788883394485","AA VV","MY VOICE A2/B1","U","PEARSON LONGMAN","1"),new n("INGLESE","9788883394492","AA VV","MY VOICE B1/B1","U","PEARSON LONGMAN","2"),new n("INGLESE","9788883395994","AA VV","MY VOICE B2","U","PEARSON LONGMAN","3"),new n("STRUTTURA, COSTRUZIONE, SISTEMI E IMPIANTI","9788884883148","AA VV","TECNICA DELL'AUTOMOBILE","U","SAN MARCO","4"),new n("STRUTTURA, COSTRUZIONE, SISTEMI E IMPIANTI","9788884884947","AA VV","TECNICA DELL'AUTOMOBILE","U","SAN MARCO","3"),new n("INGLESE","9788884885043","ODDONE CRISTINA","CLICKABLE RELOADED  AUDIO MP3  VIDEO","U","SAN MARCO","3"),new n("DIRITTO","9788891420091","AVOLIO ALESSANDRA","TRASPORTI LOGISTICA LEGGI  E MERCATI","U","SIMONE PER LA SCUOLA","5"),new n("DIRITTO ED ECONOMIA","9788891439765","AVOLIO ALESSANDRA","TRASPORTI AERONAUTICI LEGGI E MERCATI","U","SIMONE PER LA SCUOLA","3"),new n("INGLESE","9788899673154","GUALANDRI, CANELLINI","ALL ABOUT LOGISTICS PLUS  CD AUDIO 50241","U","TRINITY WHITEBRIDGE","4"),new n("INGLESE","9788899673772","GUALANDRI CLAUDIA","ALL ABOUT LOGISTICS +AC0- NEW EDITION","U","TRINITY WHITEBRIDGE","3"),new n("ITALIANO GRAMMATICA","9791254550106","SAVIGLIANO C","GRAMMATUTOR +AC0- PER PARLARE E SCRIVERE BENE","U","GARZANTI SCUOLA","1")],E=new WebSocket("wss://websocket.marconivr.it");var A=function(e,I,t,n){return new(t||(t=Promise))((function(o,E){function A(e){try{i(n.next(e))}catch(e){E(e)}}function O(e){try{i(n.throw(e))}catch(e){E(e)}}function i(e){var I;e.done?o(e.value):(I=e.value,I instanceof t?I:new t((function(e){e(I)}))).then(A,O)}i((n=n.apply(e,I||[])).next())}))};const O=localStorage.getItem("contatoreMovimenti");let i,r,T=null!=O?Number(O):0,N=String(localStorage.getItem("passwordTentata"));const c=document.getElementById("aggiungiVenditore");null==c||c.addEventListener("click",(function(){null!=C&&(C.style.display="flex")}));const C=document.getElementById("popupNuovoVenditore"),L=document.getElementById("registraVenditore");null==L||L.addEventListener("click",(function(){return A(this,void 0,void 0,(function*(){let e=new Array(5);for(let I=0;I<l.length;I++)e[I]=l[I].value;const n=yield function(){return A(this,void 0,void 0,(function*(){return new Promise(((e,I)=>{const t=i.transaction("Venditori","readonly").objectStore("Venditori").openCursor(null,"prev");t.onsuccess=()=>{const I=t.result;e(I?I.primaryKey:null)},t.onerror=()=>{I(t.error)}}))}))}();let o;o=null!==n?n+1:1;const O=new I(o,e[0],e[1],e[2],Number(e[3]),e[4]),r=i.transaction("Venditori","readwrite").objectStore("Venditori").add(O);r.onsuccess=()=>A(this,void 0,void 0,(function*(){for(let e=0;e<l.length;e++)l[e].value="";T=Number(localStorage.getItem("contatoreMovimenti")),T++,localStorage.setItem("contatoreMovimenti",String(T)),t.postMessage({store:"Venditori"}),function(e){E.send("V-"+String(e.toString())+"-"+N)}(O),yield G(yield D()),M()})),r.onerror=()=>{console.log("Venditore già presente")}}))}));const R=document.getElementById("chiudiPopup");null==R||R.addEventListener("click",M);const l=document.querySelectorAll(".testoInputPopup"),s=document.getElementById("casellaRicerca");null==s||s.addEventListener("input",(function(){return A(this,void 0,void 0,(function*(){if(null!=r){let e,I=[];if(s&&""!==s.value.trim()){e=s.value.toLowerCase();for(let t=0;t<r.length;t++)r[t].toString().toLowerCase().includes(e)&&I.push(r[t]);yield G(I)}else yield G(r)}}))}));const a=document.getElementById("elencoCompletoCopie");null==a||a.addEventListener("click",(()=>{window.open("html/elencoCompletoCopie.html")}));const S=document.getElementById("elencoCopieVendute");null==S||S.addEventListener("click",(()=>{window.open("html/copieVendute.html")}));const d=document.getElementById("elencoCopieEliminate");null==d||d.addEventListener("click",(()=>{window.open("html/copieEliminate.html")}));const u=document.getElementById("apriCarrello");function M(){null!=C&&(C.style.display="none")}function D(){return A(this,void 0,void 0,(function*(){let e;try{const t=i.transaction("Venditori","readonly").objectStore("Venditori");return e=(yield new Promise(((e,I)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>I(n.error)}))).map((e=>new I(e.id,e.nome,e.cognome,e.email,e.nTelefono,e.classe))),e}catch(e){return window.alert("Errore durante il caricamento dei venditori:"+e),null}}))}function G(e){return A(this,void 0,void 0,(function*(){const I=document.getElementById("corpoTabellaVenditori");if(I.innerHTML="",null!=e){const t=yield function(){return A(this,void 0,void 0,(function*(){let e=new Array;const I=yield new Promise(((e,I)=>{const t=i.transaction("Venditori","readonly").objectStore("Venditori").getAll();t.onsuccess=()=>e(t.result),t.onerror=()=>I(t.error)}));for(const t of I){const I=(yield new Promise(((e,I)=>{const n=i.transaction("Copie","readonly").objectStore("Copie").index("venditoreID").getAll(t.id);n.onsuccess=()=>{const I=n.result.filter((e=>"V"===e.stato));e(I)},n.onerror=()=>I(n.error)}))).reduce(((e,I)=>e+I.prezzoScontato),0);e.push(Number(I.toFixed(2)))}return e}))}();for(let n=0;n<e.length;n++){const o=document.createElement("tr"),E=document.createElement("td");E.textContent=String(e[n].id),o.appendChild(E);const A=document.createElement("td");A.textContent=e[n].nome,o.appendChild(A);const O=document.createElement("td");O.textContent=e[n].cognome,o.appendChild(O);const i=document.createElement("td");i.textContent=e[n].email,o.appendChild(i);const r=document.createElement("td");r.textContent=String(e[n].nTelefono),o.appendChild(r);const T=document.createElement("td");T.textContent=e[n].classe,o.appendChild(T);const N=document.createElement("td");N.textContent=String(t[n]),o.appendChild(N);const c=document.createElement("td"),C=document.createElement("button");C.textContent="Visualizza copie consegnate",C.addEventListener("click",(()=>U(e[n].id))),c.appendChild(C),o.appendChild(c),I.appendChild(o)}}else console.log("Nessun venditore da mostrare")}))}function U(e){const I=screen.height,t=screen.width;window.open(`html/gestoreCopieVenditore.html?venditoreID=${e}`,"_blank",`menubar=no", height=${I}, width=${t}, top=0, left=0`)}null==u||u.addEventListener("click",(()=>{window.open("html/carrello.html")})),E.onopen=function(){console.log("connessione effettuata"),E.send("stato,"+T+"-"+N),console.log("stato,"+T+"-"+N),console.log(N)},E.onclose=function(){console.log("connessione server chiusa")},E.onerror=function(e){console.log("errore nel webSocket",e)},E.onmessage=function(n){console.log(n.data);let o=n.data.split("-");"V"===o[0]?function(e){A(this,void 0,void 0,(function*(){try{const n=e.split(" ");console.log(n);const o=new I(Number(n[0]),n[1],n[2],n[3],Number(n[4]),n[5]);yield function(e){return A(this,void 0,void 0,(function*(){const I=e,n=i.transaction("Venditori","readwrite").objectStore("Venditori").add(I);n.onsuccess=()=>A(this,void 0,void 0,(function*(){for(let e=0;e<l.length;e++)l[e].value="";t.postMessage({store:"Venditori"}),yield G(yield D())})),n.onerror=()=>{console.log("Venditore già presente")}}))}(o),T=Number(localStorage.getItem("contatoreMovimenti")),console.log("ciao"+T),T++,localStorage.setItem("contatoreMovimenti",String(T)),console.log("ciao"+T)}catch(e){console.error("Errore nel salvataggio del venditore mediante CF trasmesso da socket")}}))}(o[1]):"C"===o[0]&&function(I){A(this,void 0,void 0,(function*(){try{const n=I.split(";");console.log(n);const o=yield function(e){return A(this,void 0,void 0,(function*(){const I=i.transaction("Libri","readonly").objectStore("Libri"),t=yield new Promise(((t,n)=>{const o=I.get(e);o.onsuccess=()=>{o.result?t(o.result):n(new Error("Libro non trovato con ISBN"+e))},o.onerror=e=>{console.error("Errore nella richiesta:",e),n(o.error)}}));return t}))}(Number(n[0])),E=yield function(e){return A(this,void 0,void 0,(function*(){const I=i.transaction("Venditori","readonly").objectStore("Venditori"),t=yield new Promise(((t,n)=>{const o=I.get(e);o.onsuccess=()=>{o.result?t(o.result):n(new Error("Venditore non trovato con codice fiscale: "+e))},o.onerror=e=>{console.error("Errore nella richiesta:",e),n(o.error)}}));return t}))}(Number(n[4])),O=new e(o,Number(n[1]),Number(n[2]),E,n[5],n[6]);console.log(O),yield function(e){return A(this,void 0,void 0,(function*(){"CAR"===e.stato&&(e.stato="V");const I=i.transaction("Copie","readwrite").objectStore("Copie").put(e);I.onsuccess=()=>A(this,void 0,void 0,(function*(){t.postMessage({store:"Copie"}),yield G(yield D())})),I.onerror=()=>{console.log("Copia già presente")}}))}(O),T=Number(localStorage.getItem("contatoreMovimenti")),console.log("ciao"+T),T++,localStorage.setItem("contatoreMovimenti",String(T)),console.log("ciao"+T)}catch(e){console.error("Errore nel recupero del libro mediante ISBN o del venditore mediante CF trasmesso da socket")}}))}(o[1])},t.onmessage=e=>A(void 0,void 0,void 0,(function*(){"Venditori"===e.data.store&&(console.log("Aggiornamento ricevuto: ricarico venditori..."),yield G(yield D()))})),document.addEventListener("DOMContentLoaded",(()=>A(void 0,void 0,void 0,(function*(){try{i=yield function(){let e=new Promise(((e,I)=>{const t=indexedDB.open("Database",1);t.onerror=()=>{I(t.onerror)},t.onsuccess=()=>{const I=t.result;e(I)},t.onupgradeneeded=()=>{const e=t.result;if(!e.objectStoreNames.contains("Libri")){const I=e.createObjectStore("Libri",{keyPath:"isbn"});I.createIndex("materia","materia",{unique:!1}),I.createIndex("autore","autore",{unique:!1}),I.createIndex("titolo","titolo",{unique:!1}),I.createIndex("volume","volume",{unique:!1}),I.createIndex("editore","editore",{unique:!1}),I.createIndex("prezzoListino","prezzoListino",{unique:!1}),I.createIndex("classe","classe",{unique:!1})}if(!e.objectStoreNames.contains("Copie")){const I=e.createObjectStore("Copie",{keyPath:"codiceUnivoco"});I.createIndex("libroDellaCopiaISBN","libroDellaCopiaISBN",{unique:!1}),I.createIndex("prezzoScontato","prezzoScontato",{unique:!1}),I.createIndex("venditoreID","venditoreID",{unique:!1}),I.createIndex("stato","stato",{unique:!1}),I.createIndex("ultimaModifica","ultimaModifica",{unique:!1})}if(!e.objectStoreNames.contains("CopieRicevuta")){const I=e.createObjectStore("CopieRicevuta",{keyPath:"codiceUnivoco"});I.createIndex("libroDellaCopiaISBN","libroDellaCopiaISBN",{unique:!1}),I.createIndex("prezzoScontato","prezzoScontato",{unique:!1}),I.createIndex("venditoreID","venditoreID",{unique:!1}),I.createIndex("stato","stato",{unique:!1}),I.createIndex("ultimaModifica","ultimaModifica",{unique:!1})}if(!e.objectStoreNames.contains("Venditori")){const I=e.createObjectStore("Venditori",{keyPath:"id"});I.createIndex("nome","nome",{unique:!1}),I.createIndex("cognome","cognome",{unique:!1}),I.createIndex("email","email",{unique:!1}),I.createIndex("nTelefono","nTelefono",{unique:!0}),I.createIndex("classe","classe",{unique:!1})}}}));return e}(),console.log("Database aperto:",i.name),yield function(){return A(this,void 0,void 0,(function*(){try{const e=i.transaction("Libri","readonly").objectStore("Libri").count();e.onsuccess=()=>{0===e.result?function(){const e=i.transaction("Libri","readwrite"),I=e.objectStore("Libri");for(let e=0;e<o.length;e++)I.add(o[e]);e.oncomplete=()=>{console.log("Libri caricati con successo.")},e.onerror=()=>{console.error("Errore durante il caricamento dei libri statici.")}}():console.log("Libri già presenti nel database")},e.onerror=()=>{console.error("Errore nel conteggio dei libri.")}}catch(e){console.error("Errore durante l'accesso al DB:",e)}}))}(),r=yield D(),yield G(r)}catch(e){console.error("Errore apertura DB:",e)}}))))})();