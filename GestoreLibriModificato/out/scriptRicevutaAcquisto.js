(()=>{"use strict";var e=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,a)}l((o=o.apply(e,n||[])).next())}))};let n,t,o;new URLSearchParams(window.location.search);const r=document.getElementById("importoTotale"),i=document.getElementById("dataAcquisto"),c=document.getElementById("nomeCliente"),a=document.getElementById("contantiDati");null==a||a.addEventListener("keydown",(e=>s(e))),null==a||a.addEventListener("blur",(()=>s(null)));const l=document.getElementById("resto"),d=document.getElementById("stampa");function s(n){return e(this,void 0,void 0,(function*(){if(""===c.value&&null!==n)window.alert("Inserire nome e cognome del cliente!");else if(n instanceof KeyboardEvent&&"Enter"===n.key||n instanceof MouseEvent&&n.target===d||null===n){const e=parseFloat((Number(a.value)-o).toFixed(2));e<0?null!==n&&window.alert("Contanti insufficienti!"):(l.textContent=String(e),null!==n&&window.print())}}))}null==d||d.addEventListener("click",(e=>s(e))),document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{n=yield function(){let e=new Promise(((e,n)=>{const t=indexedDB.open("Database",1);t.onerror=()=>{n(t.onerror)},t.onsuccess=()=>{const n=t.result;e(n)}}));return e}(),console.log("Database aperto:",n.name),t=yield function(){return e(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const o=n.transaction("CopieRicevuta","readonly").objectStore("CopieRicevuta").getAll();o.onsuccess=()=>{e(o.result)},o.onerror=()=>{t(o.error)}}))}))}(),yield function(){return e(this,void 0,void 0,(function*(){try{const e=document.getElementById("corpoTabellaCopie");e.innerHTML="";for(let o=0;o<t.length;o++){let r=t[o];const i=yield new Promise(((e,t)=>{const o=n.transaction("Libri","readonly").objectStore("Libri").get(r.libroDellaCopiaISBN);o.onsuccess=()=>{o.result?e(o.result):t(new Error("Libro con ISBN non trovato"))},o.onerror=()=>{t(new Error("Database dei libri non reperibile"))}})),c=document.createElement("tr"),a=document.createElement("td");a.textContent=i.titolo,c.appendChild(a);const l=document.createElement("td");l.textContent=String(r.prezzoScontato),c.appendChild(l),e.appendChild(c)}i.innerHTML=(new Date).toLocaleString()}catch(e){e instanceof Error&&console.error(e.message)}}))}(),o=function(){let e=0;return t.forEach((n=>{e+=n.prezzoScontato})),r.innerHTML=String(e),e}()}catch(e){e instanceof Error&&console.error(e.message)}}))))})();