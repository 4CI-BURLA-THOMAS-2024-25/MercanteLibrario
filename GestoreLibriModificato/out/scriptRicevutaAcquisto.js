(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}s((o=o.apply(e,t||[])).next())}))};const t=new URLSearchParams(window.location.search),n=t.get("nome"),o=t.get("cognome");let r;const i=document.getElementById("importoTotale"),c=document.getElementById("dataAcquisto"),a=document.getElementById("datiCliente");document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{r=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",r.name),yield function(){return e(this,void 0,void 0,(function*(){try{const t=yield function(){return e(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=r.transaction("CopieRicevuta","readonly").objectStore("CopieRicevuta").getAll();n.onsuccess=()=>{e(n.result)},n.onerror=()=>{t(n.error)}}))}))}();!function(e){let t=0;e.forEach((e=>{t+=e.prezzoScontato})),i.innerHTML=String(t)}(t);const s=document.getElementById("corpoTabellaCopie");s.innerHTML="";for(let e=0;e<t.length;e++){let n=t[e];const o=yield new Promise(((e,t)=>{const o=r.transaction("Libri","readonly").objectStore("Libri").get(n.libroDellaCopiaISBN);o.onsuccess=()=>{o.result?e(o.result):t(new Error("Libro con ISBN non trovato"))},o.onerror=()=>{t(new Error("Database dei libri non reperibile"))}})),i=document.createElement("tr"),c=document.createElement("td");c.textContent=o.titolo,i.appendChild(c);const a=document.createElement("td");a.textContent=String(n.prezzoScontato),i.appendChild(a),s.appendChild(i)}c.innerHTML=(new Date).toLocaleString(),a.innerHTML=`${n} ${o}`}catch(e){e instanceof Error&&console.error(e.message)}}))}(),window.print(),yield function(){return e(this,void 0,void 0,(function*(){const e=r.transaction("CopieRicevuta","readwrite").objectStore("CopieRicevuta").clear();e.onsuccess=()=>{},e.onerror=()=>{throw new Error("Errore, impossbile completare la stampa!")}}))}()}catch(e){e instanceof Error&&console.error(e.message)}}))))})();