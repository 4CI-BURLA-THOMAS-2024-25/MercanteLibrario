(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}l((o=o.apply(e,t||[])).next())}))};let t,n,o;new URLSearchParams(window.location.search);const r=document.getElementById("importoTotale"),i=document.getElementById("dataAcquisto"),c=(document.getElementById("nomeCliente"),document.getElementById("contantiDati"));null==c||c.addEventListener("keydown",(e=>d(e))),null==c||c.addEventListener("blur",(()=>d(null)));const a=document.getElementById("resto"),l=document.getElementById("stampa");function d(t){return e(this,void 0,void 0,(function*(){if(t instanceof KeyboardEvent&&"Enter"===t.key||t instanceof MouseEvent&&t.target===l||null===t){const e=parseFloat((Number(c.value)-o).toFixed(2));e<0?null!==t&&window.alert("Contanti insufficienti!"):(a.textContent=String(e),null!==t&&window.print())}}))}null==l||l.addEventListener("click",(e=>d(e))),document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{t=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",t.name),n=yield function(){return e(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{const o=t.transaction("CopieRicevuta","readonly").objectStore("CopieRicevuta").getAll();o.onsuccess=()=>{e(o.result)},o.onerror=()=>{n(o.error)}}))}))}(),yield function(){return e(this,void 0,void 0,(function*(){try{const e=document.getElementById("corpoTabellaCopie");e.innerHTML="";for(let o=0;o<n.length;o++){let r=n[o];const i=yield new Promise(((e,n)=>{const o=t.transaction("Libri","readonly").objectStore("Libri").get(r.libroDellaCopiaISBN);o.onsuccess=()=>{o.result?e(o.result):n(new Error("Libro con ISBN non trovato"))},o.onerror=()=>{n(new Error("Database dei libri non reperibile"))}})),c=document.createElement("tr"),a=document.createElement("td");a.textContent=i.titolo,c.appendChild(a);const l=document.createElement("td");l.textContent=String(r.prezzoScontato),c.appendChild(l),e.appendChild(c)}i.innerHTML=(new Date).toLocaleString()}catch(e){e instanceof Error&&console.error(e.message)}}))}(),o=function(){let e=0;return n.forEach((t=>{e+=t.prezzoScontato})),r.innerHTML=String(e),e}()}catch(e){e instanceof Error&&console.error(e.message)}}))))})();