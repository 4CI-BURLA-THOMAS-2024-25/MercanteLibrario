(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}l((o=o.apply(e,t||[])).next())}))};const t=new URLSearchParams(window.location.search),n=t.get("nome"),o=t.get("cognome");let r,i,c;const a=document.getElementById("importoTotale"),l=document.getElementById("dataAcquisto"),d=document.getElementById("datiCliente"),s=document.getElementById("contantiDati");null==s||s.addEventListener("keydown",(e=>f(e))),null==s||s.addEventListener("blur",(()=>f(null)));const u=document.getElementById("resto"),m=document.getElementById("stampa");function f(t){return e(this,void 0,void 0,(function*(){if(t instanceof KeyboardEvent&&"Enter"===t.key||t instanceof MouseEvent&&t.target===m||null===t){const e=parseFloat((Number(s.value)-c).toFixed(2));e<0?null!==t&&window.alert("Contanti insufficienti!"):(u.textContent=String(e),null!==t&&window.print())}}))}null==m||m.addEventListener("click",(e=>f(e))),document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{r=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",r.name),i=yield function(){return e(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=r.transaction("CopieRicevuta","readonly").objectStore("CopieRicevuta").getAll();n.onsuccess=()=>{e(n.result)},n.onerror=()=>{t(n.error)}}))}))}(),yield function(){return e(this,void 0,void 0,(function*(){try{const e=document.getElementById("corpoTabellaCopie");e.innerHTML="";for(let t=0;t<i.length;t++){let n=i[t];const o=yield new Promise(((e,t)=>{const o=r.transaction("Libri","readonly").objectStore("Libri").get(n.libroDellaCopiaISBN);o.onsuccess=()=>{o.result?e(o.result):t(new Error("Libro con ISBN non trovato"))},o.onerror=()=>{t(new Error("Database dei libri non reperibile"))}})),c=document.createElement("tr"),a=document.createElement("td");a.textContent=o.titolo,c.appendChild(a);const l=document.createElement("td");l.textContent=String(n.prezzoScontato),c.appendChild(l),e.appendChild(c)}l.innerHTML=(new Date).toLocaleString(),d.innerHTML=`${n} ${o}`}catch(e){e instanceof Error&&console.error(e.message)}}))}(),c=function(){let e=0;return i.forEach((t=>{e+=t.prezzoScontato})),a.innerHTML=String(e),e}()}catch(e){e instanceof Error&&console.error(e.message)}}))))})();