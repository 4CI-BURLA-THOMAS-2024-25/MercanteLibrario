(()=>{"use strict";class e{constructor(e,t,n,o,r,i,l){this.materia=null!=e?e:"-",Number(t)>0?this.isbn=Number(t):this.isbn=0,this.autore=null!=n?n:"-",this.titolo=null!=o?o:"-",null!=r&&1==r.length?this.volume=r:this.volume="-",this.editore=null!=i?i:"-",this.classe=null!=l?l:"-"}toString(){return[this.materia,this.isbn,this.autore,this.titolo,this.volume,this.editore,this.classe].join(" ")}}var t=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,c)}s((o=o.apply(e,t||[])).next())}))};const n=new URLSearchParams(window.location.search),o=n.get("venditoreID"),r=n.get("prezzoCopertina"),i=document.getElementById("casellaRicerca");let l,c;null==i||i.addEventListener("input",(function(){if(null!=c){let e,t=[];if(i&&""!==i.value.trim()){e=i.value.toLowerCase();for(let n=0;n<c.length;n++)c[n].toString().toLowerCase().includes(e)&&t.push(c[n]);a(t)}else a(c)}}));const s=document.getElementById("tornaAlleCopie");function a(e){return t(this,void 0,void 0,(function*(){if(null!=e){const n=yield function(){return t(this,void 0,void 0,(function*(){if(null!=c){let e=[];for(const t of c){const n=yield new Promise(((e,n)=>{const o=l.transaction("Copie","readonly").objectStore("Copie").index("libroDellaCopiaISBN").count(t.isbn);o.onsuccess=()=>e(o.result),o.onerror=()=>n(o.onerror)}));e.push(n)}return e}return null}))}();if(null!=n){const t=document.getElementById("corpoTabellaLibri");t.innerHTML="";for(let o=0;o<e.length;o++){const r=document.createElement("tr"),i=document.createElement("td"),l=document.createElement("input");l.setAttribute("type","checkbox"),l.setAttribute("class","caselleSelezione"),i.appendChild(l),r.appendChild(l);const c=document.createElement("td");c.textContent=e[o].materia,r.appendChild(c);const s=document.createElement("td");s.textContent=String(e[o].isbn),r.appendChild(s);const a=document.createElement("td");a.textContent=e[o].autore,r.appendChild(a);const d=document.createElement("td");d.textContent=e[o].titolo,r.appendChild(d);const u=document.createElement("td");u.textContent=e[o].volume,r.appendChild(u);const h=document.createElement("td");h.textContent=e[o].editore,r.appendChild(h);const m=document.createElement("td");m.textContent=e[o].classe,r.appendChild(m);const p=document.createElement("td");p.textContent=String(n[o]),r.appendChild(p),t.appendChild(r)}}}else console.log("Nessun libro da mostrare")}))}null==s||s.addEventListener("click",(()=>function(){var e,t;const n=null===(e=document.querySelector("input[type='checkbox']:checked"))||void 0===e?void 0:e.closest("tr");if(n){const e=null===(t=n.querySelector("td:nth-child(3)"))||void 0===t?void 0:t.textContent,i=new URLSearchParams;i.set("venditoreID",o),i.set("prezzoCopertina",r),i.set("isbn",e),window.location.href=`gestoreCopieVenditore.html?${i.toString()}`}else alert("Seleziona una riga prima di tornare indietro.")}())),document.addEventListener("DOMContentLoaded",(()=>t(void 0,void 0,void 0,(function*(){try{l=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",l.name),c=yield function(){return t(this,void 0,void 0,(function*(){try{let t;const n=l.transaction("Libri","readonly").objectStore("Libri");return t=(yield new Promise(((e,t)=>{const o=n.getAll();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)}))).map((t=>new e(t.materia,String(t.isbn),t.autore,t.titolo,t.volume,t.editore,t.classe))),t}catch(e){return window.alert("Errore durante il caricamento dei venditori:"+e),null}}))}(),yield a(c);const n=document.querySelectorAll(".caselleSelezione");n.forEach((e=>{e.addEventListener("change",(()=>{e.checked&&n.forEach((t=>{t!==e&&(t.checked=!1)}))}))}))}catch(e){console.error("Errore apertura DB:",e)}}))))})();