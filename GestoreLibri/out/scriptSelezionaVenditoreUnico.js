(()=>{"use strict";class e{constructor(e,t,n,o,i,c){let r=Number(i);this.codFiscale=null!=e?e:"-",this.nome=null!=t?t:"-",this.cognome=null!=n?n:"-",this.email=null!=o?o:"-",this.nTelefono=r>0?r:0,this.classe=null!=c?c:"-",this.soldiDaDare=0,this.copieDate=[]}addSoldiDaDare(e){e>0&&(this.soldiDaDare+=e)}getSoldiDaDare(){return this.soldiDaDare}addCopia(e){null!=e&&this.copieDate.push(e)}getCopie(){return this.copieDate}}var t=function(e,t,n,o){return new(n||(n=Promise))((function(i,c){function r(e){try{d(o.next(e))}catch(e){c(e)}}function l(e){try{d(o.throw(e))}catch(e){c(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}d((o=o.apply(e,t||[])).next())}))};const n=new URLSearchParams(window.location.search),o=n.get("isbn"),i=n.get("percentualeSconto");let c;const r=document.getElementById("aggiungiVenditore");null==r||r.addEventListener("click",(function(){null!=l&&(l.style.display="flex")}));const l=document.getElementById("popupNuovoVenditore"),d=document.getElementById("registraVenditore");null==d||d.addEventListener("click",(function(){let t=new Array(6);for(let e=0;e<s.length;e++)t[e]=s[e].value;const n=new e(t[0],t[1],t[2],t[3],t[4],t[5]),o=c.transaction("Venditori","readwrite").objectStore("Venditori").add(n);o.onsuccess=()=>{p(),m()},o.onerror=()=>{console.log("Venditore gi√† presente")}}));const a=document.getElementById("chiudiPopup");null==a||a.addEventListener("click",m);const s=document.querySelectorAll(".testoInputPopup"),u=document.getElementById("tornaAlleCopie");function m(){null!=l&&(l.style.display="none")}function p(){return t(this,void 0,void 0,(function*(){const e=c.transaction("Venditori","readonly").objectStore("Venditori");try{!function(e){t(this,void 0,void 0,(function*(){const t=document.getElementById("corpoTabellaVenditori");t.innerHTML="";for(let n=0;n<e.length;n++){const o=document.createElement("tr"),i=document.createElement("td"),c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("class","caselleSelezione"),i.appendChild(c),o.appendChild(c);const r=document.createElement("td"),l=document.createElement("button");l.textContent="Rimuovi venditore",l.addEventListener("click",(()=>h(e[n].codFiscale))),r.appendChild(l),o.appendChild(r);const d=document.createElement("td");d.textContent=e[n].codFiscale,o.appendChild(d);const a=document.createElement("td");a.textContent=e[n].nome,o.appendChild(a);const s=document.createElement("td");s.textContent=e[n].cognome,o.appendChild(s);const u=document.createElement("td");u.textContent=e[n].email,o.appendChild(u);const m=document.createElement("td");m.textContent=String(e[n].nTelefono),o.appendChild(m);const p=document.createElement("td");p.textContent=e[n].classe,o.appendChild(p);const v=document.createElement("td");v.textContent=String(e[n].soldiDaDare),o.appendChild(v),t.appendChild(o)}}))}(yield new Promise(((t,n)=>{const o=e.getAll();o.onsuccess=()=>t(o.result),o.onerror=()=>n(o.error)})))}catch(e){window.alert("Errore durante il caricamento dei venditori:"+e)}}))}function h(e){return t(this,void 0,void 0,(function*(){if(window.confirm("Sei sicuro di voler cancellare il venditore?"))try{const t=c.transaction("Venditori","readwrite").objectStore("Venditori").delete(e);yield new Promise(((e,n)=>{t.onsuccess=()=>{window.alert("Venditore eliminato con successo"),e()},t.onerror=()=>{console.error("Errore nella cancellazione:",t.error),n(t.error)}})),p()}catch(e){window.alert("Errore nella cancellazione:"+e)}else window.alert("Eliminazione annullata")}))}null==u||u.addEventListener("click",(()=>function(){var e,t;const c=null===(e=document.querySelector("input[type='checkbox']:checked"))||void 0===e?void 0:e.closest("tr");if(c){const e=null===(t=c.querySelector("td:nth-child(3)"))||void 0===t?void 0:t.textContent;new URLSearchParams,n.set("isbn",o),n.set("percentualeSconto",i),n.set("codiceFiscale",e),window.location.href=`popupGestoreCopie.html?${n.toString()}`}else alert("Seleziona una riga prima di tornare indietro.")}())),document.addEventListener("DOMContentLoaded",(()=>t(void 0,void 0,void 0,(function*(){try{c=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",c.name),yield p();const e=document.querySelectorAll(".caselleSelezione");e.forEach((t=>{t.addEventListener("change",(()=>{t.checked&&e.forEach((e=>{e!==t&&(e.checked=!1)}))}))}))}catch(e){console.error("Errore apertura DB:",e)}}))))})();