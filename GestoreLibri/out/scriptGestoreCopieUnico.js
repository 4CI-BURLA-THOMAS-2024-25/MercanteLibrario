(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function d(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,d)}l((o=o.apply(e,t||[])).next())}))};const t=new URLSearchParams(window.location.search),n=t.get("isbn"),o=t.get("codiceFiscale");let r,i,c;console.log(o);const d=document.getElementById("aggiungiCopia");null==d||d.addEventListener("click",v);const l=document.getElementById("popupRegistraCopia"),s=document.getElementById("registraCopia");null==s||s.addEventListener("click",(function(){}));const a=document.getElementById("chiudiPopup");null==a||a.addEventListener("click",(function(){null!=l&&(l.style.display="none")}));const u=document.getElementById("scegliVenditore");null==u||u.addEventListener("click",(function(){const e=new URLSearchParams;e.set("isbn",n);const t=m.value;e.set("percentualeSconto",t),window.location.href=`selezionaVenditore.html?${e.toString()}`}));const m=document.getElementById("selezionaSconto"),p=document.getElementById("IDVenditore");function v(){null!=l&&(l.style.display="flex")}null!=o&&function(){e(this,void 0,void 0,(function*(){try{null!=o&&(c=yield function(t){return e(this,void 0,void 0,(function*(){const e=r.transaction("Venditori","readonly").objectStore("Venditori");return yield new Promise(((n,o)=>{const r=e.get(t);r.onsuccess=()=>{r.result?n(r.result):o(new Error("Venditore non trovato con codice fiscale: "+t))},r.onerror=e=>{console.error("Errore nella richiesta:",e),o(r.error)}}))}))}(o),m.value=t.get("percentualeSconto"),p.textContent=c.nome+" "+c.cognome,v())}catch(e){console.error("Venditore NON reperibile",e)}}))}(),document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{r=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",r.name),yield function(){return e(this,void 0,void 0,(function*(){if(!n)throw new Error("ISBN non valido");console.log("ISBN cercato:",n);const e=r.transaction("Libri","readonly").objectStore("Libri");if(i=yield new Promise(((t,o)=>{const r=e.get(Number(n));r.onsuccess=()=>{r.result?t(r.result):o(new Error("Libro non trovato con ISBN: "+n))},r.onerror=e=>{console.error("Errore nella richiesta:",e),o(r.error)}})),i){const e=document.getElementById("corpoInfoLibro");e.innerHTML="";const t=document.createElement("tr");t.innerHTML=`<td>${i.materia}</td><td>${i.isbn}</td><td>${i.autore}</td><td>${i.titolo}</td><td>${i.volume}</td><td>${i.editore}</td><td>${i.prezzoListino}</td><td>${i.classe}</td>`,e.appendChild(t);const n=document.getElementById("corpoTabellaCopie");n.innerHTML="";const o=i.copie;for(let e=0;e<o.length;e++){let t=o[e];const r=document.createElement("tr");r.innerHTML=`<td>${t.codiceUnivoco}</td><td>${t.venditore}</td><td>${t.scontoPrezzoListino}</td>`,n.appendChild(r)}}else console.error("Libro non trovato con ISBN:",n)}))}()}catch(e){console.error("Errore apertura DB:",e)}}))))})();