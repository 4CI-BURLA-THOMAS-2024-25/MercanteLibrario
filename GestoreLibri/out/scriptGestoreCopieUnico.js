(()=>{"use strict";var e=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function d(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(c,d)}l((o=o.apply(e,n||[])).next())}))};const n=new URLSearchParams(window.location.search),t=n.get("isbn"),o=n.get("codiceFiscale");let r,i,c;console.log(o);const d=document.getElementById("aggiungiCopia");null==d||d.addEventListener("click",p);const l=document.getElementById("popupRegistraCopia"),s=document.getElementById("registraCopia");null==s||s.addEventListener("click",(function(){}));const a=document.getElementById("chiudiPopup");null==a||a.addEventListener("click",(function(){null!=l&&(l.style.display="none")}));const u=document.getElementById("scegliVenditore");null==u||u.addEventListener("click",(function(){const e=new URLSearchParams;e.set("isbn",t);const n=m.value;e.set("percentualeSconto",n),window.location.href=`selezionaVenditore.html?${e.toString()}`}));const m=document.getElementById("selezionaSconto"),v=document.getElementById("IDVenditore");function p(){null!=l&&(l.style.display="flex")}document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{r=yield function(){let e=new Promise(((e,n)=>{const t=indexedDB.open("Database",1);t.onerror=()=>{n(t.onerror)},t.onsuccess=()=>{const n=t.result;e(n)}}));return e}(),console.log("Database aperto:",r.name),yield function(){return e(this,void 0,void 0,(function*(){if(!t)throw new Error("ISBN non valido");console.log("ISBN cercato:",t);const e=r.transaction("Libri","readonly").objectStore("Libri");if(i=yield new Promise(((n,o)=>{const r=e.get(Number(t));r.onsuccess=()=>{r.result?n(r.result):o(new Error("Libro non trovato con ISBN: "+t))},r.onerror=e=>{console.error("Errore nella richiesta:",e),o(r.error)}})),i){const e=document.getElementById("corpoInfoLibro");e.innerHTML="";const n=document.createElement("tr");n.innerHTML=`<td>${i.materia}</td><td>${i.isbn}</td><td>${i.autore}</td><td>${i.titolo}</td><td>${i.volume}</td><td>${i.editore}</td><td>${i.prezzoListino}</td><td>${i.classe}</td>`,e.appendChild(n);const t=document.getElementById("corpoTabellaCopie");t.innerHTML="";const o=i.copie;for(let e=0;e<o.length;e++){let n=o[e];const r=document.createElement("tr");r.innerHTML=`<td>${n.codiceUnivoco}</td><td>${n.venditore}</td><td>${n.scontoPrezzoListino}</td>`,t.appendChild(r)}}else console.error("Libro non trovato con ISBN:",t)}))}(),null!=o&&function(){e(this,void 0,void 0,(function*(){try{null!=o&&(c=yield function(n){return e(this,void 0,void 0,(function*(){const e=r.transaction("Venditori","readonly").objectStore("Venditori");return yield new Promise(((t,o)=>{const r=e.get(n);r.onsuccess=()=>{r.result?t(r.result):o(new Error("Venditore non trovato con codice fiscale: "+n))},r.onerror=e=>{console.error("Errore nella richiesta:",e),o(r.error)}}))}))}(o),m.value=n.get("percentualeSconto"),v.value=c.nome+" "+c.cognome,p())}catch(e){console.error("Venditore NON reperibile",e)}}))}()}catch(e){console.error("Errore apertura DB:",e)}}))))})();