(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function c(e){try{l(o.next(e))}catch(e){i(e)}}function d(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,d)}l((o=o.apply(e,t||[])).next())}))};const t=new URLSearchParams(window.location.search).get("isbn");let n,o;const r=document.getElementById("aggiungiCopia");null==r||r.addEventListener("click",(function(){null!=i&&(i.style.display="flex")}));const i=document.getElementById("popupRegistraCopia"),c=document.getElementById("chiudiPopup");null==c||c.addEventListener("click",(function(){null!=i&&(i.style.display="none")}));const d=document.getElementById("scegliVenditore");null==d||d.addEventListener("click",(function(){screen.height,screen.width,window.open("selezionaVenditore.html")})),document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){try{n=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",n.name),yield function(){return e(this,void 0,void 0,(function*(){if(!t)throw new Error("ISBN non valido");console.log("ISBN cercato:",t);const e=n.transaction("Libri","readonly").objectStore("Libri");if(o=yield new Promise(((n,o)=>{const r=e.get(Number(t));r.onsuccess=()=>{r.result?n(r.result):o(new Error("Libro non trovato con ISBN: "+t))},r.onerror=e=>{console.error("Errore nella richiesta:",e),o(r.error)}})),o){const e=document.getElementById("corpoInfoLibro");e.innerHTML="";const t=document.createElement("tr");t.innerHTML=`<td>${o.materia}</td><td>${o.isbn}</td><td>${o.autore}</td><td>${o.titolo}</td><td>${o.volume}</td><td>${o.editore}</td><td>${o.prezzoListino}</td><td>${o.classe}</td>`,e.appendChild(t);const n=document.getElementById("corpoTabellaCopie");n.innerHTML="";const r=o.getCopieAsArray();for(let e=0;e<o.getNCopie();e++){let t=r[e];const o=document.createElement("tr");o.innerHTML=`<td>${t.codiceUnivoco}</td><td>${t.venditore}</td><td>${t.scontoPrezzoListino}</td>`,n.appendChild(o)}}else console.error("Libro non trovato con ISBN:",t)}))}()}catch(e){console.error("Errore apertura DB:",e)}}))))})();