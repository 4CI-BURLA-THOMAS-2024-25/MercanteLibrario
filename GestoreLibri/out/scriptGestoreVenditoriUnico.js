(()=>{"use strict";class e{constructor(e,t,n,o,r,c){let i=Number(r);this.codFiscale=null!=e?e:"-",this.nome=null!=t?t:"-",this.cognome=null!=n?n:"-",this.email=null!=o?o:"-",this.nTelefono=i>0?i:0,this.classe=null!=c?c:"-"}}const t=new BroadcastChannel("aggiornamentoDatabase");var n=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function i(e){try{l(o.next(e))}catch(e){c(e)}}function d(e){try{l(o.throw(e))}catch(e){c(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,d)}l((o=o.apply(e,t||[])).next())}))};let o;const r=document.getElementById("aggiungiVenditore");null==r||r.addEventListener("click",(function(){null!=c&&(c.style.display="flex")}));const c=document.getElementById("popupNuovoVenditore"),i=document.getElementById("registraVenditore");null==i||i.addEventListener("click",(function(){let n=new Array(6);for(let e=0;e<l.length;e++)n[e]=l[e].value;const r=new e(n[0],n[1],n[2],n[3],n[4],n[5]),c=o.transaction("Venditori","readwrite").objectStore("Venditori").add(r);c.onsuccess=()=>{a(),s(),t.postMessage({store:"Venditori",action:"add"})},c.onerror=()=>{console.log("Venditore giÃ  presente")}}));const d=document.getElementById("chiudiPopup");null==d||d.addEventListener("click",s);const l=document.querySelectorAll(".testoInputPopup");function s(){null!=c&&(c.style.display="none")}function a(){return n(this,void 0,void 0,(function*(){const e=o.transaction("Venditori","readonly").objectStore("Venditori");try{!function(e){n(this,void 0,void 0,(function*(){const t=document.getElementById("corpoTabellaVenditori");t.innerHTML="";const r=yield function(){return n(this,void 0,void 0,(function*(){let e=new Array;const t=yield new Promise(((e,t)=>{const n=o.transaction("Venditori","readonly").objectStore("Venditori").getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}));for(const n of t){const t=(yield new Promise(((e,t)=>{const r=o.transaction("Copie","readonly").objectStore("Copie").index("venditoreCF").getAll(n.codFiscale);r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)}))).reduce(((e,t)=>e+t.prezzoScontato),0);e.push(t)}return e}))}();for(let n=0;n<e.length;n++){const o=document.createElement("tr"),c=document.createElement("td");c.textContent=e[n].codFiscale,o.appendChild(c);const i=document.createElement("td");i.textContent=e[n].nome,o.appendChild(i);const d=document.createElement("td");d.textContent=e[n].cognome,o.appendChild(d);const l=document.createElement("td");l.textContent=e[n].email,o.appendChild(l);const s=document.createElement("td");s.textContent=String(e[n].nTelefono),o.appendChild(s);const a=document.createElement("td");a.textContent=e[n].classe,o.appendChild(a);const m=document.createElement("td");m.textContent=String(r[n]),o.appendChild(m);const p=document.createElement("td"),h=document.createElement("button");h.textContent="Visualizza copie consegnate",h.addEventListener("click",(()=>u(e[n].codFiscale))),p.appendChild(h),o.appendChild(p),t.appendChild(o)}}))}(yield new Promise(((t,n)=>{const o=e.getAll();o.onsuccess=()=>t(o.result),o.onerror=()=>n(o.error)})))}catch(e){window.alert("Errore durante il caricamento dei venditori:"+e)}}))}function u(e){const t=screen.height,n=screen.width;window.open(`gestoreCopieVenditore.html?codFiscale=${e}`,"_blank",`menubar=no", height=${t}, width=${n}, top=0, left=0`)}document.addEventListener("DOMContentLoaded",(()=>n(void 0,void 0,void 0,(function*(){try{o=yield function(){let e=new Promise(((e,t)=>{const n=indexedDB.open("Database",1);n.onerror=()=>{t(n.onerror)},n.onsuccess=()=>{const t=n.result;e(t)}}));return e}(),console.log("Database aperto:",o.name),yield a()}catch(e){console.error("Errore apertura DB:",e)}}))))})();